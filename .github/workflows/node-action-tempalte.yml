# .github/workflows/template.yml

# è¤‡æ•°ã®ãƒˆãƒªã‚¬ãƒ¼ã‚’å®šç¾©
# ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã‚’è§£é™¤ã—ã¦ä½¿ç”¨ã™ã‚‹ãƒˆãƒªã‚¬ãƒ¼ã‚’é¸æŠå¯èƒ½
name: GitHub Actions Template
on:
  # ãƒ—ãƒƒã‚·ãƒ¥æ™‚ã®å®Ÿè¡Œè¨­å®š
  push:
    branches: [ doci/** ]
    # ç‰¹å®šã®ãƒ–ãƒ©ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æŒ‡å®šå¯èƒ½
    # branches: [ 'feature/**', 'releases/**' ]
    paths-ignore:
      - '.github/**'
      - '**.md'
      - 'docs/**'
  
  # ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã®å®Ÿè¡Œè¨­å®š
  # pull_request:
  #   branches: [ main ]
  #   types: [opened, synchronize, reopened]
  
  # æ‰‹å‹•å®Ÿè¡Œç”¨ãƒˆãƒªã‚¬ãƒ¼
  # workflow_dispatch:
  #   inputs:
  #     environment:
  #       description: 'Environment to run tests against'
  #       type: choice
  #       options: 
  #         - dev
  #         - staging
  #         - prod
  #       required: true
  
  # ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œ
  # schedule:
  #   - cron: '0 0 * * *'  # æ¯æ—¥åˆå‰0æ™‚ã«å®Ÿè¡Œ

# ç’°å¢ƒå¤‰æ•°ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®š
env:
  DEFAULT_NODE_VERSION: '18'
  DEFAULT_PYTHON_VERSION: '3.11'

# åŒæ™‚å®Ÿè¡Œã®åˆ¶å¾¡
# è©³ç´°: https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#concurrency
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  # åŸºæœ¬çš„ãªå˜ä¸€ã‚¸ãƒ§ãƒ–ã®ä¾‹
  basic-job:
    name: Basic Job Example
    runs-on: ubuntu-latest
    
    # ç’°å¢ƒå¤‰æ•°ï¼ˆã‚¸ãƒ§ãƒ–ãƒ¬ãƒ™ãƒ«ï¼‰
    env:
      JOB_SPECIFIC_VAR: "value"
    
    # ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š
    timeout-minutes: 10
    
    steps:
      # ãƒ‡ãƒãƒƒã‚°ç”¨ã®æƒ…å ±å‡ºåŠ›
      - name: Debug Information
        run: |
          echo "ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ±:"
          echo "Branch: ${{ github.ref }}"
          echo "Event: ${{ github.event_name }}"
          echo "Workspace: ${{ github.workspace }}"
          echo "Repository: ${{ github.repository }}"
          # ç’°å¢ƒå¤‰æ•°ã®ä¸€è¦§ã‚’è¡¨ç¤º
          echo "ğŸ“ ç’°å¢ƒå¤‰æ•°:"
          env | sort
      
      # ãƒªãƒã‚¸ãƒˆãƒªã®ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0  # å…¨å±¥æ­´ã‚’å–å¾—ï¼ˆå¿…è¦ãªå ´åˆï¼‰
      
      # Node.jsã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¾‹
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.DEFAULT_NODE_VERSION }}
          cache: 'npm'  # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®åˆ©ç”¨
      
      # æ¡ä»¶ä»˜ãã‚¹ãƒ†ãƒƒãƒ—ã®ä¾‹
      - name: Conditional Step
        if: github.event_name == 'push'
        run: echo "This step runs only on push events"

  # ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ã‚¸ãƒ§ãƒ–ã®ä¾‹
  matrix-job:
    name: Matrix Job Example
    needs: basic-job  # ä¾å­˜é–¢ä¿‚ã®å®šç¾©
    runs-on: ${{ matrix.os }}
    
    # ãƒãƒˆãƒªãƒƒã‚¯ã‚¹æˆ¦ç•¥ã®å®šç¾©
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest]
        node: [16, 18]
        include:
          - os: ubuntu-latest
            node: 18
            npm-flags: '--production'
      # å¤±æ•—æ™‚ã®å‹•ä½œè¨­å®š
      fail-fast: false
      max-parallel: 2
    
    steps:
      - uses: actions/checkout@v4
      
      # ãƒãƒˆãƒªãƒƒã‚¯ã‚¹å¤‰æ•°ã®ä½¿ç”¨ä¾‹
      - name: Show Matrix Info
        run: |
          echo "OS: ${{ matrix.os }}"
          echo "Node: ${{ matrix.node }}"
          echo "NPM Flags: ${{ matrix.npm-flags }}"

  # ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã®å‡¦ç†ä¾‹
  artifact-job:
    name: Artifact Handling Example
    needs: [basic-job, matrix-job]
    runs-on: ubuntu-latest
    
    steps:
      # ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã®ä½œæˆ
      - name: Create artifact
        run: |
          mkdir -p artifacts
          echo "Build timestamp: $(date)" > artifacts/build-info.txt
      
      # ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
      - uses: actions/upload-artifact@v4
        with:
          name: build-artifacts
          path: artifacts/
          retention-days: 5

# ãƒ˜ãƒ«ãƒ—ãƒ•ãƒ«ã‚³ãƒ¡ãƒ³ãƒˆ
# 
# ãƒ‡ãƒãƒƒã‚°ã«å½¹ç«‹ã¤ç’°å¢ƒå¤‰æ•°:
# - GITHUB_WORKSPACE: ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ãƒ‘ã‚¹
# - GITHUB_ENV: ç’°å¢ƒãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹
# - GITHUB_PATH: PATHãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹
# - GITHUB_STEP_SUMMARY: ã‚¹ãƒ†ãƒƒãƒ—ã‚µãƒãƒªãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹
# 
# ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã®æœ‰åŠ¹åŒ–:
# - ãƒªãƒã‚¸ãƒˆãƒªã®Secretsã« ACTIONS_STEP_DEBUG = true ã‚’è¨­å®š
# - ã¾ãŸã¯ã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å®Ÿè¡Œæ™‚ã« Enable debug logging ã‚’é¸æŠ
# 
# ä¾¿åˆ©ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒªãƒ³ã‚¯:
# - ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ§‹æ–‡: https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions
# - ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ: https://docs.github.com/en/actions/learn-github-actions/contexts
# - å¼: https://docs.github.com/en/actions/learn-github-actions/expressions
# - ç’°å¢ƒå¤‰æ•°: https://docs.github.com/en/actions/learn-github-actions/environment-variables